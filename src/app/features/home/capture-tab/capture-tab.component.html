<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="refreshCaptures($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  <mat-card *transloco="let t" class="user-card" id="user-card">
    <app-avatar mat-card-avatar></app-avatar>
    <mat-card-header>
      <mat-card-title (click)="editUsername()">{{
        username$ | ngrxPush
      }}</mat-card-title>
      <div class="vertical-space-8"></div>
      <mat-card-subtitle>{{ email$ | ngrxPush }} </mat-card-subtitle>
    </mat-card-header>
  </mat-card>
  <app-uploading-bar></app-uploading-bar>

  <div [ngSwitch]="segment">
    <ion-segment mode="md" [(ngModel)]="segment">
      <ion-segment-button [value]="captureTabSegments.VERIFIED">
        <ion-label>{{ 'home.profileTab.validated' | transloco }}</ion-label>
      </ion-segment-button>
      <ion-segment-button [value]="captureTabSegments.COLLECTED">
        <ion-label>{{ 'home.profileTab.collected' | transloco }}</ion-label>
      </ion-segment-button>
      <ion-segment-button [value]="captureTabSegments.DRAFT">
        <ion-label>{{ 'home.profileTab.draft' | transloco }}</ion-label>
      </ion-segment-button>
    </ion-segment>

    <div *ngSwitchCase="captureTabSegments.VERIFIED">
      <div class="capture-container" *transloco="let t">
        <mat-grid-list cols="2" gutterSize="16px">
          <mat-grid-tile
            *ngFor="
              let proof of validatedTabItems$ | ngrxPush;
              first as isFirstProof;
              trackBy: trackCaptureItem
            "
            class="capture-item"
            [joyrideStep]="isFirstProof ? 'highlightFirstCapture' : 'notFirst'"
            [title]="t('userGuide.capturedItem')"
            [text]="t('userGuide.openToSeeDetailsAndMoreActionItems')"
          >
            <app-capture-item [proof]="proof"></app-capture-item>
          </mat-grid-tile>
        </mat-grid-list>
      </div>
    </div>

    <div class="post-captures" *ngSwitchCase="captureTabSegments.COLLECTED">
      <mat-grid-list cols="2" gutterSize="16px">
        <mat-grid-tile
          class="capture-item"
          *ngFor="
            let postCapture of collectedTabItems$ | ngrxPush;
            trackBy: trackPostCapture
          "
          [routerLink]="[
            'details',
            { type: 'post-capture', id: postCapture.id }
          ]"
        >
          <ng-container *ngIf="postCapture.asset_file_mime_type as mimeType">
            <ion-icon
              *ngIf="mimeType | startsWith: 'video'"
              name="videocam"
              class="is-video"
            ></ion-icon>
          </ng-container>
          <ion-icon
            *ngIf="postCapture.source_type === 'store'"
            name="storefront"
            class="is-from-store"
          ></ion-icon>
          <ion-img [src]="postCapture.asset_file_thumbnail"></ion-img>
        </mat-grid-tile>
      </mat-grid-list>
    </div>

    <div *ngSwitchCase="captureTabSegments.DRAFT">
      <div class="capture-container" *transloco="let t">
        <mat-grid-list cols="2" gutterSize="16px">
          <mat-grid-tile
            *ngFor="
              let proof of draftTabItems$ | ngrxPush;
              trackBy: trackCaptureItem
            "
            class="capture-item"
          >
            <app-capture-item [proof]="proof"></app-capture-item>
          </mat-grid-tile>
        </mat-grid-list>
      </div>
    </div>
  </div>

  <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMoreItems($event)">
    <ion-infinite-scroll-content loading-spinner="bubbles">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>
