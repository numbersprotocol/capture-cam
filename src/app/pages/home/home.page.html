<mat-sidenav-container *transloco="let t">
  <mat-sidenav #sidenav mode="over" autoFocus="false">
    <mat-toolbar color="primary">
      <button (click)="sidenav.toggle()" mat-icon-button>
        <mat-icon>arrow_back</mat-icon>
      </button>
      <span>{{ username$ | async }}</span>
    </mat-toolbar>

    <mat-nav-list>
      <mat-list-item>
        <a routerLink="/profile" (click)="sidenav.close()" mat-list-item>{{
          t('profile')
        }}</a>
      </mat-list-item>
      <mat-list-item>
        <a routerLink="/settings" (click)="sidenav.close()" mat-list-item>{{
          t('settings')
        }}</a>
      </mat-list-item>
      <mat-list-item>
        <a routerLink="/privacy" (click)="sidenav.close()" mat-list-item>{{
          t('privacy')
        }}</a>
      </mat-list-item>
      <mat-list-item>
        <a routerLink="/about" (click)="sidenav.close()" mat-list-item>{{
          t('about')
        }}</a>
      </mat-list-item>
    </mat-nav-list>
  </mat-sidenav>

  <mat-sidenav-content>
    <mat-toolbar color="primary">
      <button (click)="sidenav.toggle()" mat-icon-button>
        <mat-icon>menu</mat-icon>
      </button>
      <span class="toolbar-spacer"></span>
      <button routerLink="transaction" mat-icon-button>
        <mat-icon>history</mat-icon>
      </button>
      <button routerLink="inbox" mat-icon-button>
        <mat-icon
          matBadge="&#8288;"
          [matBadgeHidden]="
            (inboxCount$ | async) === null || (inboxCount$ | async) === 0
          "
          matBadgeSize="small"
          matBadgeColor="warn"
        >
          all_inbox</mat-icon
        >
      </button>
    </mat-toolbar>

    <mat-tab-group
      (selectedTabChange)="onTapChanged($event)"
      mat-align-tabs="center"
      backgroundColor="primary"
    >
      <mat-tab label="Capture">
        <div class="tab-content-capture">
          <ng-container
            *ngFor="
              let captureByDate of capturesByDate$
                | async
                | keyvalue: keyDescendingOrder
            "
          >
            <div class="mat-title">{{ captureByDate.key }}</div>
            <mat-grid-list cols="3" gutterSize="8px">
              <ng-container *ngFor="let capture of captureByDate.value">
                <mat-grid-tile
                  *ngIf="capture.item.diaBackendAsset"
                  class="square-image-tile"
                  [style.backgroundImage]="
                    'url(' + ((capture.thumbnailUrl | async) || '') + ')'
                  "
                  [routerLink]="[
                    'asset',
                    { id: capture.item.diaBackendAsset.id }
                  ]"
                >
                </mat-grid-tile>
                <ng-container *ngIf="!capture.item.diaBackendAsset">
                  <mat-grid-tile
                    class="square-image-tile"
                    [style.backgroundImage]="
                      'url(' + ((capture.thumbnailUrl | async) || '') + ')'
                    "
                  >
                    <div
                      class="image-tile-overlay"
                      (click)="upload(capture.item.proof)"
                    ></div>
                    <div class="overlay-icon">
                      <mat-spinner
                        *ngIf="
                          currentUploadingProofHash === capture.item.hash;
                          else uploadError
                        "
                        diameter="50"
                      ></mat-spinner>
                      <ng-template #uploadError>
                        <mat-icon>error</mat-icon>
                      </ng-template>
                    </div>
                  </mat-grid-tile>
                </ng-container>
              </ng-container>
            </mat-grid-list>
          </ng-container>
        </div>
      </mat-tab>
      <mat-tab label="PostCapture">
        <div class="tab-content-post">
          <app-post-capture-card
            *ngFor="let postCapture of postCaptures$ | async"
            [transaction]="postCapture"
          >
          </app-post-capture-card>
        </div>
      </mat-tab>
    </mat-tab-group>
    <button
      *ngIf="captureButtonShow"
      (click)="capture()"
      mat-fab
      color="primary"
    >
      <mat-icon>camera_alt</mat-icon>
    </button>
  </mat-sidenav-content>
</mat-sidenav-container>
